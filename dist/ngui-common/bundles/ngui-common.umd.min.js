!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("@angular/common"),require("@angular/core")):"function"==typeof define&&define.amd?define("@ngui/common",["exports","rxjs","@angular/common","@angular/core"],t):t((e.ngui=e.ngui||{},e.ngui.common={}),e.rxjs,e.ng.common,e.ng.core)}(this,function(e,t,n,o){"use strict";var i=(s.prototype.ngOnInit=function(){this.options&&(this.observerOptions=this.options),n.isPlatformBrowser(this.platformId)&&(this.observer=new IntersectionObserver(this.handleIntersect.bind(this),this.observerOptions),this.observer.observe(this.element.nativeElement))},s.prototype.ngOnDestroy=function(){this.observer.disconnect()},s.prototype.handleIntersect=function(e){var t=this;e.forEach(function(e){e.isIntersecting?(t.isInview=!0,t.defaultInviewHandler(e),t.inview.emit(e)):t.notInview.emit(e)})},s.prototype.defaultInviewHandler=function(e){if(this.blurEnabled&&!this.once80PctVisible&&!this.inview.observers.length)if(e.intersectionRatio<.8){var t=1.25*e.intersectionRatio,n="blur("+(20-4*Math.floor(10*e.intersectionRatio))+"px)";Object.assign(e.target.style,{opacity:t,filter:n})}else e.target.style.opacity=1,e.target.style.filter="unset",this.once80PctVisible=!0},s.decorators=[{type:o.Component,args:[{selector:"ngui-inview",template:'\n        <ng-container *ngIf="isInview" [ngTemplateOutlet]="template">\n        </ng-container>\n    ',styles:[":host {display: block;}"]}]}],s.ctorParameters=function(){return[{type:o.ElementRef},{type:undefined,decorators:[{type:o.Inject,args:[o.PLATFORM_ID]}]}]},s.propDecorators={template:[{type:o.ContentChild,args:[o.TemplateRef]}],observerOptions:[{type:o.Input}],options:[{type:o.Input}],blurEnabled:[{type:o.Input}],inview:[{type:o.Output}],notInview:[{type:o.Output}]},s);function s(e,t){this.element=e,this.platformId=t,this.observerOptions={threshold:[.1,.2,.3,.4,.5,.6,.7,.8]},this.blurEnabled=!0,this.inview=new o.EventEmitter,this.notInview=new o.EventEmitter,this.isInview=!1,this.once80PctVisible=!1}var r=(p.prototype.ngOnInit=function(){this.options&&(this.observerOptions=this.options),n.isPlatformBrowser(this.platformId)&&(this.observer=new IntersectionObserver(this.handleIntersect.bind(this),this.observerOptions),this.observer.observe(this.element.nativeElement))},p.prototype.ngOnDestroy=function(){n.isPlatformBrowser(this.platformId)&&this.observer&&this.observer.disconnect()},p.prototype.handleIntersect=function(e){var t=this;e.forEach(function(e){e.isIntersecting?t.nguiInview.emit(e):t.nguiOutview.emit(e)})},p.decorators=[{type:o.Directive,args:[{selector:"[nguiInview], [nguiOutview]"}]}],p.ctorParameters=function(){return[{type:o.ElementRef},{type:undefined,decorators:[{type:o.Inject,args:[o.PLATFORM_ID]}]}]},p.propDecorators={observerOptions:[{type:o.Input}],options:[{type:o.Input}],nguiInview:[{type:o.Output}],nguiOutview:[{type:o.Output}]},p);function p(e,t){this.element=e,this.platformId=t,this.observerOptions={threshold:[.1,.2,.3,.4,.5,.6,.7,.8]},this.nguiInview=new o.EventEmitter,this.nguiOutview=new o.EventEmitter}var a=(c.decorators=[{type:o.NgModule,args:[{imports:[n.CommonModule],declarations:[i,r],exports:[i,r]}]}],c);function c(){}var u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function l(e,t,n){var i;return void 0===n&&(n={}),"click"===t||t.match(/^mouse/)?i=new MouseEvent(t,n):t.match(/^key/)?i=new KeyboardEvent(t,n):t.match(/^touch/)&&(i=new TouchEvent(t,n)),e.dispatchEvent(i)}var h=(d.prototype.createComponent=function(e,t){return this.rootViewContainer=t||this.rootViewContainer,this.factoryResolver.resolveComponentFactory(e).create(this.rootViewContainer.parentInjector)},d.prototype.insertComponent=function(e){var t="ngui-dyn-"+(Math.floor(Math.random()*Math.pow(10,7))+Math.pow(10,6));return e.location.nativeElement.setAttribute("id",t),e.instance.id=t,this.rootViewContainer.insert(e.hostView),e.instance},d.decorators=[{type:o.Injectable}],d.ctorParameters=function(){return[{type:undefined,decorators:[{type:o.Inject,args:[o.ComponentFactoryResolver]}]}]},d);function d(e){this.factoryResolver=e}var m=(g.prototype.restoreItems=function(){this.outView&&(this.outView=!1,this.items=Array.from(this.itemsBackup||[]),this.itemsBackup=undefined,this.renderer.setStyle(this.contentsEl,"height",undefined),this.cdRef.detectChanges())},g.prototype.ngOnInit=function(){this.contentsEl=this.element.nativeElement.querySelector(".inview-page.contents")},g.prototype.ngOnDestroy=function(){console.log("NguiInviewPageComponent.ngOnDestroy() is called"),this.destroyed=!0},g.prototype.emptyItems=function(){if(this.items&&this.contentsEl&&!this.outView){var e=this.element.nativeElement.getBoundingClientRect().height;this.renderer.setStyle(this.contentsEl,"height",e+"px"),this.outView=!0,this.itemsBackup=Array.from(this.items||[]),this.items=undefined,this.destroyed||this.cdRef.detectChanges()}},g.prototype.setItems=function(e){this.destroyed||(console.log("NguiInviewPageComponent.setItems() is called with",e),this.items=e,this.cdRef.detectChanges())},g.decorators=[{type:o.Component,args:[{selector:"ngui-inview-page",template:'\n    <div class="inview-page contents"\n      (nguiInview)="restoreItems()"\n      (nguiOutview)="emptyItems()">\n      \x3c!-- add blank ngui-list-item by condition  --\x3e\n      \x3c!-- no match found ngui-list-item by condition --\x3e\n      <ng-container\n        [ngTemplateOutlet]="template||defaultTemplate"\n        [ngTemplateOutletContext]="{items: items, outView: outView}">\n      </ng-container>\n      <div *ngIf="outView">{{ itemsBackup.length }} items hidden</div>\n    </div>\n\n    <ng-template #defaultTemplate>\n      <div *ngIf="!items"> Error: requires [items] </div>\n      <div *ngIf="!template"> Error: requires &lt;ng-template></div>\n    </ng-template>\n  ',styles:["\n    :host {display: block}\n  "]}]}],g.ctorParameters=function(){return[{type:o.ElementRef},{type:o.Renderer2},{type:o.ChangeDetectorRef}]},g.propDecorators={template:[{type:o.ContentChild,args:[o.TemplateRef]}],items:[{type:o.Input}]},g);function g(e,t,n){this.element=e,this.renderer=t,this.cdRef=n,this.outView=!1,this.itemsBackup=[]}var v=(f.prototype.ngAfterViewInit=function(){this.template&&this.bottomInview.observers.length||console.error("<ngui-virtual-list> requires [template] and {bottomInview)")},f.prototype.addAnInviewPageToPages=function(){this.isListLoading?console.log("Already a page being inserted, skipping adding a page"):(this.isListLoading=!0,this.inviewPage=this.dynamicComponentService.createComponent(m,this.pagesRef),this.dynamicComponentService.insertComponent(this.inviewPage),this.inviewPage.instance.template=this.template,this.inviewPages.push(this.inviewPage),this.bottomInview.emit(this))},f.prototype.addList=function(e){this.isListLoading=!1,console.log(">>>>>> NguiVirtualListComponent.addList() is called()"),this.inviewPage.instance.setItems(e)},f.decorators=[{type:o.Component,args:[{selector:"ngui-virtual-list",template:'\n    <div class="ngui-virtual-list"\n      (focus)="_focused = true"\n      (click)="_focused = true">\n      \x3c!-- hold multiple <ngui-inview-page> --\x3e\n      <div #pages></div>\n      \x3c!-- insert <ngui-inview-page> into #pages --\x3e\n      <ngui-inview (inview)="addAnInviewPageToPages()"></ngui-inview>\n    </div>\n  ',styles:["\n    :host {display: block}\n  "]}]}],f.ctorParameters=function(){return[{type:o.Renderer2},{type:o.ElementRef},{type:h},{type:o.ChangeDetectorRef}]},f.propDecorators={pagesRef:[{type:o.ViewChild,args:["pages",{read:o.ViewContainerRef}]}],template:[{type:o.ContentChild,args:[o.TemplateRef]}],selected:[{type:o.Output}],escaped:[{type:o.Output}],bottomInview:[{type:o.Output}]},f);function f(e,t,n,i){this.renderer=e,this.element=t,this.dynamicComponentService=n,this.cdr=i,this.selected=new o.EventEmitter,this.escaped=new o.EventEmitter,this.bottomInview=new o.EventEmitter,this._focused=!1,this.inviewPages=[]}var y,w=function T(){this.html="No Match Found"},I=function S(){this.html="Select"},E=(function j(e,t){function n(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(b,y=v),Object.defineProperty(b.prototype,"isReady",{get:function(){var e=this._selectedFromList||this._escapedFromList,t=this._focused.input||this._focused.listItem,n=this.inputEl.value.length>=this.minInputChars;return!e&&t&&n},enumerable:!0,configurable:!0}),b.prototype.ngOnInit=function(){this.inputEl=document.querySelector("#"+this["for"]),this.positionThisUnderInputEl(),t.fromEvent(this.inputEl,"keyup").subscribe(this.onInputElKeyup.bind(this)),this.inputEl.addEventListener("focus",this.onInputElFocused.bind(this)),this.inputEl.addEventListener("blur",this.onInputElBlurred.bind(this)),this.selected.subscribe(this.onSelected.bind(this)),this.escaped.subscribe(this.onEscaped.bind(this))},b.prototype.onSelected=function(e){this._selectedFromList=!0,this.inputEl.focus(),this._lastSelected=e,this.cdr.detectChanges(),console.log("NguiAutoCompleteComponent.onSelected() is called",e)},b.prototype.onEscaped=function(){this._escapedFromList=!0,this.inputEl.focus(),this._lastSelected||(this.inputEl.value=this._orgInputValue),this.cdr.detectChanges(),console.log("NguiAutoCompleteComponent.onEscaped() is called")},b.prototype.onInputElFocused=function(e){console.log("NguiAutoCompleteComponent.onInputElFocused() is called",e),this.isListLoading=!1,"undefined"==typeof this._orgInputValue&&(this._orgInputValue=this.inputEl.value),this._prevInputValue=this.inputEl.value,this.setFocused("input",!0)},b.prototype.onInputElBlurred=function(){this.setFocused("input",!1)},b.prototype.clearList=function(){this.inviewPages.forEach(function(e){e.destroy()}),this.inviewPages=[]},b.prototype.onInputElKeyup=function(e){console.log("NguiAutoCompleteComponent.onInputKeyup() is called",e.key);var t=this.element.nativeElement.querySelector("ngui-list-item");"Enter"===e.key||"Escape"===e.key?t?l(t,"keyup",{key:e.key}):this.onEscaped():"ArrowDown"!==e.key&&"ArrowRight"!==e.key||!t?"ArrowUp"===e.key||"ArrowLeft"===e.key||this.inputEl.value.length>=this.minInputChars&&(this._selectedFromList=!1,this._escapedFromList=!1,this.addAutocompleteList()):t.focus()},b.prototype.addAutocompleteList=function(){var e=this;this.isReady&&(clearTimeout(this._acTimer),this._acTimer=setTimeout(function(){e.isListLoading=!1,e._prevInputValue=e.inputEl.value,e._escapedFromList=!1,e._selectedFromList=!1,e.clearList(),e.addAnInviewPageToPages()},200))},b.prototype.addMorePages=function(){this.inviewPages.length&&this.addAnInviewPageToPages()},b.prototype.setFocused=function(e,t){var n=this;t?(clearTimeout(this._focusTimer),this._focused={input:!1,listItem:!1},this._focused[e]=!0):this._focusTimer=setTimeout(function(){n._focused[e]=!1,n.cdr.detectChanges()},100)},b.prototype.positionThisUnderInputEl=function(){var e=this.element.nativeElement,t=this.inputEl.getBoundingClientRect(),n=t.top+t.height+window.scrollY;this.renderer.setStyle(e,"left",t.left+"px"),this.renderer.setStyle(e,"top",n+"px"),this.renderer.setStyle(e,"minWidth",t.width+"px")},b.prototype.addList=function(e){var t;console.log(">>>>>> NguiAutocompleteComponent.addList() is called()"),this.isListLoading=!1;var n={};1===this.inviewPages.length&&(!this.noMatchItem||e&&0!==e.length?this.blankOption&&((n=new I).html=this.blankOption):(t=new w,n.html=this.noMatchItem));var i=[].concat(t,n,e).filter(function(e){return e});this.inviewPage.instance.setItems(i),this.cdr.detectChanges()},b.decorators=[{type:o.Component,args:[{selector:"ngui-autocomplete",template:'\n    <div *ngIf="isReady" class="ngui-autocomplete">\n      <div #pages></div>\n      <ngui-inview (inview)="addMorePages()"></ngui-inview>\n    </div>\n  ',styles:["\n    :host {position: absolute; background-color: #fff; max-height: 300px; overflow: auto}\n    .ngui-autocomplete { border: 1px solid #ccc; padding: 4px }\n  "]}]}],b.propDecorators={"for":[{type:o.Input}],minInputChars:[{type:o.Input}],blankOption:[{type:o.Input}],noMatchItem:[{type:o.Input}],template:[{type:o.ContentChild,args:[o.TemplateRef]}]},b);function b(){var e=null!==y&&y.apply(this,arguments)||this;return e.minInputChars=1,e.blankOption="Select One",e.noMatchItem="No Match Found",e._focused={input:!1,listItem:!1},e}var L=(C.decorators=[{type:o.Directive,args:[{selector:"ngui-list"}]}],C.ctorParameters=function(){return[{type:o.ElementRef}]},C.propDecorators={selected:[{type:o.Output}],escaped:[{type:o.Output}]},C);function C(e){this.element=e,this.selected=new o.EventEmitter,this.escaped=new o.EventEmitter}var O=(P.prototype.ngOnInit=function(){if(this.renderer.setAttribute(this.el.nativeElement,"tabindex","0"),this.parentListComp=this.listDirective||this.virtualListComponent||this.autocompleteComponent,!this.parentListComp)throw Error("ngui-list-item requires parent of ngui-list, ngui-virtual-list, or ngui-autocomplete.");(this.object instanceof I||this.object instanceof w)&&(this.viewContainer.clear(),this.el.nativeElement.innerHTML=this.object.html)},P.prototype.keydown=function(e){var t=this.el.nativeElement,n=e.which||e.keyCode,i=this.parentListComp.element.nativeElement,o=Array.from(i.querySelectorAll("ngui-list-item")),s=o.indexOf(t),r=o[s+1]||o[0],p=o[s-1]||o[o.length-1];switch(n){case 37:case 38:p.focus();break;case 39:case 40:r.focus()}},P.prototype.keyup=function(e){switch(e.key){case"Enter":this.parentListComp.selected.emit(this.object);break;case"Escape":this.parentListComp.escaped.emit()}},P.prototype.mousedown=function(){this.parentListComp.selected.emit(this.object)},P.prototype.focused=function(){this.parentListComp.setFocused&&this.parentListComp.setFocused("listItem",!0)},P.prototype.blurred=function(){this.parentListComp.setFocused&&this.parentListComp.setFocused("listItem",!1)},P.decorators=[{type:o.Directive,args:[{selector:"ngui-list-item"}]}],P.ctorParameters=function(){return[{type:o.ElementRef},{type:o.Renderer2},{type:o.ViewContainerRef},{type:L,decorators:[{type:o.Optional},{type:o.Host}]},{type:v,decorators:[{type:o.Optional},{type:o.Host}]},{type:E,decorators:[{type:o.Optional},{type:o.Host}]}]},P.propDecorators={object:[{type:o.Input,args:["item"]}],keydown:[{type:o.HostListener,args:["keydown",["$event"]]}],keyup:[{type:o.HostListener,args:["keyup",["$event"]]}],mousedown:[{type:o.HostListener,args:["click",["$event"]]}],focused:[{type:o.HostListener,args:["focus",["$event"]]}],blurred:[{type:o.HostListener,args:["blur",["$event"]]}]},P);function P(e,t,n,i,o,s){this.el=e,this.renderer=t,this.viewContainer=n,this.listDirective=i,this.virtualListComponent=o,this.autocompleteComponent=s}var R=(_.decorators=[{type:o.NgModule,args:[{imports:[n.CommonModule,a],declarations:[E,m,L,O,v],exports:[E,m,L,O,v],entryComponents:[m]}]}],_);function _(){}var k=(N.prototype.transform=function(e,t){var n=e;if(t){var i=new RegExp(t,"ig");n=e.replace(i,function(e){return'<span class="ngui-highlight">'+e+"</span>"})}return n},N.decorators=[{type:o.Pipe,args:[{name:"nguiHighlight"}]}],N);function N(){}var x=(V.toLog=function(e){return this.LOG_LEVELS[this.logLevel]<this.LOG_LEVELS[e]},V.setLogLevel=function(e){e=e.toUpperCase();var t=Object.keys(this.LOG_LEVELS);-1<t.indexOf(e)?(window&&window.sessionStorage&&window.sessionStorage.setItem("konsole.LOG_LEVEL",e),this.logLevel=e):console.error("Error, invalid logLevel, it must be one of "+t)},V.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.toLog("DEBUG")&&console.debug.apply(console,arguments)},V.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.toLog("LOG")&&console.log.apply(console,arguments)},V.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.toLog("INFO")&&console.info.apply(console,arguments)},V.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.toLog("WARN")&&console.warn.apply(console,arguments)},V.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.toLog("ERROR")&&console.error.apply(console,arguments)},V.LOG_LEVELS={ALL:parseInt("00000",2),DEBUG:parseInt("00001",2),LOG:parseInt("00010",2),INFO:parseInt("00100",2),WARN:parseInt("01000",2),ERROR:parseInt("10000",2),NONE:parseInt("11111",2)},V.logLevel="INFO",V);function V(){}var A=(M.decorators=[{type:o.NgModule,args:[{imports:[n.CommonModule],declarations:[k],exports:[k],providers:[h]}]}],M);function M(){}var D=(F.decorators=[{type:o.NgModule,args:[{imports:[a,R,A],exports:[a,R,A]}]}],F);function F(){}e.NguiInviewComponent=i,e.NguiInviewDirective=r,e.NguiInviewModule=a,e.NguiAutocompleteComponent=E,e.NguiListItemDirective=O,e.NguiListDirective=L,e.NguiInviewPageComponent=m,e.NguiVirtualListComponent=v,e.NguiListModule=R,e.DynamicComponentService=h,e.NguiHighlightPipe=k,e.konsole=x,e.fireEvent=l,e.NguiUtilsModule=A,e.NguiCommonModule=D,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngui-common.umd.min.js.map